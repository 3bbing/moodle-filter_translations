{"version":3,"sources":["../src/translation_button.js"],"names":["define","$","ModalFactory","Str","templates","translation_button","each","attr","on","opentranslation","event","stopPropagation","preventDefault","clickedbutton","keys","key","component","classList","prop","context","i","l","length","matches","match","objects","rawtext_unprocessed","rawtext","decodeURIComponent","replace","get_strings","then","langStrings","render","done","html","create","title","body","type","types","ALERT","modal","show","fail","Notification","exception","translationinfo"],"mappings":"AAwBAA,OAAM,0CAAC,CAAC,QAAD,CAAW,oBAAX,CAAiC,UAAjC,CAA6C,gBAA7C,CAAD,CAAiE,SAAUC,CAAV,CAAaC,CAAb,CAA2BC,CAA3B,CAAgCC,CAAhC,CAA2C,CAC9G,GAAIC,CAAAA,CAAkB,CAAG,CACrB,KAAQ,eAAY,CAChBJ,CAAC,CAAC,oCAAD,CAAD,CAAwCK,IAAxC,CAA6C,UAAW,CACpDL,CAAC,CAAC,IAAD,CAAD,CAAQM,IAAR,CAAa,MAAb,CAAqB,QAArB,CACH,CAFD,EAIAN,CAAC,CAAC,MAAD,CAAD,CAAUO,EAAV,CAAa,OAAb,CAAsB,oCAAtB,CAA4DH,CAAkB,CAACI,eAA/E,EACAR,CAAC,CAAC,MAAD,CAAD,CAAUO,EAAV,CAAa,aAAb,CAA4B,oCAA5B,CAAkEH,CAAkB,CAACI,eAArF,CACH,CARoB,CASrB,gBAAmB,yBAAUC,CAAV,CAAiB,CAChCA,CAAK,CAACC,eAAN,GACAD,CAAK,CAACE,cAAN,GAcA,OAZIC,CAAAA,CAAa,CAAGZ,CAAC,CAAC,IAAD,CAYrB,CAVIa,CAAI,CAAG,CACP,CACIC,GAAG,CAAE,oBADT,CAEIC,SAAS,CAAE,qBAFf,CADO,CAUX,CAHIC,CAAS,CAAGJ,CAAa,CAACK,IAAd,CAAmB,WAAnB,CAGhB,CAFIC,CAAO,CAAG,IAEd,CAASC,CAAC,CAAG,CAAb,CAAgBC,CAAC,CAAGJ,CAAS,CAACK,MAA9B,CACQC,CADR,CAAsCH,CAAC,CAAGC,CAA1C,CAA6C,EAAED,CAA/C,CAAkD,CAC1CG,CAD0C,CAChCN,CAAS,CAACG,CAAD,CAAT,CAAaI,KAAb,CAAmB,+BAAnB,CADgC,CAE9C,GAAID,CAAO,EAAsB,CAAlB,EAAAA,CAAO,CAACD,MAAvB,CAAoC,CAChCH,CAAO,CAAGd,CAAkB,CAACoB,OAAnB,CAA2BF,CAAO,CAAC,CAAD,CAAlC,CAAV,CACA,KACH,CACJ,CAED,GAAI,CAACJ,CAAL,CAAc,CACV,MACH,CAEDA,CAAO,CAACO,mBAAR,CAA8BP,CAAO,CAACQ,OAAtC,CACAR,CAAO,CAACQ,OAAR,CAAkBC,kBAAkB,CAACT,CAAO,CAACO,mBAAR,CAA4BG,OAA5B,CAAoC,KAApC,CAA2C,GAA3C,CAAD,CAApC,CAEA1B,CAAG,CAAC2B,WAAJ,CAAgBhB,CAAhB,EAAsBiB,IAAtB,CAA2B,SAAUC,CAAV,CAAuB,CAC9C,MAAO5B,CAAAA,CAAS,CAAC6B,MAAV,CAAiB,iDAAjB,CAAoEd,CAApE,EAA6Ee,IAA7E,CAAkF,SAAUC,CAAV,CAAgB,CACrGjC,CAAY,CAACkC,MAAb,CAAoB,CAChBC,KAAK,CAAEL,CAAW,CAAC,CAAD,CADF,CAEhBM,IAAI,CAAEH,CAFU,CAGhBI,IAAI,CAAErC,CAAY,CAACsC,KAAb,CAAmBC,KAHT,CAApB,EAIGV,IAJH,CAIQ,SAAUW,CAAV,CAAiB,CACrBA,CAAK,CAACC,IAAN,EACH,CAND,CAOH,CARM,CASV,CAVD,EAUGC,IAVH,CAUQC,YAAY,CAACC,SAVrB,CAWH,CAnDoB,CAoDrB,SAAY,kBAAU/B,CAAV,CAAegC,CAAf,CAAgC,CACxC1C,CAAkB,CAACoB,OAAnB,CAA2BV,CAA3B,EAAkCgC,CACrC,CAtDoB,CAuDrBtB,OAAO,CAAE,EAvDY,CAAzB,CA0DA,MAAOpB,CAAAA,CACV,CA5DK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package filter_translations\n * @author Andrew Hancox <andrewdchancox@googlemail.com>\n * @author Open Source Learning <enquiries@opensourcelearning.co.uk>\n * @link https://opensourcelearning.co.uk\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @copyright 2021, Andrew Hancox\n */\n\ndefine(['jquery', 'core/modal_factory', 'core/str', 'core/templates'], function ($, ModalFactory, Str, templates) {\n    var translation_button = {\n        'init': function () {\n            $('.filter_translations_btn_translate').each(function() {\n                $(this).attr('role', 'button'); // Purify_html will have removed this attribute.\n            });\n\n            $('body').on('click', '.filter_translations_btn_translate', translation_button.opentranslation);\n            $('body').on('contextmenu', '.filter_translations_btn_translate', translation_button.opentranslation);\n        },\n        'opentranslation': function (event) {\n            event.stopPropagation();\n            event.preventDefault();\n\n            var clickedbutton = $(this);\n\n            var keys = [\n                {\n                    key: 'translationdetails',\n                    component: 'filter_translations'\n                },\n            ];\n\n            var classList = clickedbutton.prop('classList');\n            var context = null;\n\n            for (var i = 0, l = classList.length; i < l; ++i) {\n                var matches = classList[i].match(/translationkey_([a-zA-Z0-9]+)/);\n                if (matches && matches.length == 2) {\n                    context = translation_button.objects[matches[1]];\n                    break;\n                }\n            }\n\n            if (!context) {\n                return;\n            }\n\n            context.rawtext_unprocessed = context.rawtext;\n            context.rawtext = decodeURIComponent(context.rawtext_unprocessed.replace(/\\+/g, ' '));\n\n            Str.get_strings(keys).then(function (langStrings) {\n                return templates.render('filter_translations/translationdetailsmodalbody', context).done(function (html) {\n                    ModalFactory.create({\n                        title: langStrings[0],\n                        body: html,\n                        type: ModalFactory.types.ALERT\n                    }).then(function (modal) {\n                        modal.show();\n                    });\n                });\n            }).fail(Notification.exception);\n        },\n        'register': function (key, translationinfo) {\n            translation_button.objects[key] = translationinfo;\n        },\n        objects: {}\n    };\n\n    return translation_button;\n});\n"],"file":"translation_button.min.js"}