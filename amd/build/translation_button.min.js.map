{"version":3,"sources":["../src/translation_button.js"],"names":["define","$","ModalFactory","Str","templates","translation_button","returnurl","on","opentranslation","elems","findElementsDirectlyContainingText","document","forEach","elem","binary","exec","html","replace","key","parseInt","translationinfo","objects","render","done","append","event","stopPropagation","preventDefault","context","data","get_strings","component","then","langStrings","create","title","body","type","types","ALERT","modal","show","fail","Notification","exception","ancestor","text","elements","walk","element","n","childNodes","length","i","child","nodeType","indexOf","push"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package filter_translations\n * @author Andrew Hancox <andrewdchancox@googlemail.com>\n * @author Open Source Learning <enquiries@opensourcelearning.co.uk>\n * @link https://opensourcelearning.co.uk\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @copyright 2021, Andrew Hancox\n */\n\ndefine(['jquery', 'core/modal_factory', 'core/str', 'core/templates'], function ($, ModalFactory, Str, templates) {\n    var translation_button = {\n        'returnurl': '',\n        'init': function (returnurl) {\n            translation_button.returnurl = returnurl;\n            $('body').on('click', '.filter_translations_btn_translate', translation_button.opentranslation);\n            $('body').on('contextmenu', '.filter_translations_btn_translate', translation_button.opentranslation);\n        },\n        'findandinjectbuttons': function() {\n            var encodedone = \"\\u{200B}\"; // Zero-Width Space\n            var encodedzero = \"\\u{200C}\"; // Zero-Width Non-Joiner\n            var encodedseperator = \"\\u{200D}\"; // Zero-Width Joiner\n\n            var elems = translation_button.findElementsDirectlyContainingText(document, encodedseperator + encodedseperator);\n            elems.forEach(function(elem) {\n                var matches = new RegExp(encodedseperator + encodedseperator + '([' + encodedone + encodedzero + ']*)');\n\n                var regexzero = new RegExp(encodedzero, 'g');\n                var regexone = new RegExp(encodedone, 'g');\n\n                var binary = matches.exec($(elem).html())[1].replace(regexone, '1').replace(regexzero, '0');\n                var key = parseInt(binary, 2);\n                var translationinfo = translation_button.objects[key];\n\n                templates.render('filter_translations/translatebutton', translationinfo).done(function (html) {\n                    $(elem).append(html);\n                });\n            });\n        },\n        'opentranslation': function (event) {\n            event.stopPropagation();\n            event.preventDefault();\n\n            var context = translation_button.objects[$(this).data('inpagetranslationid')];\n            context.returnurl = translation_button.returnurl;\n\n            Str.get_strings([{\n                key: 'translationdetails',\n                component: 'filter_translations'\n            }]).then(function (langStrings) {\n                return templates.render('filter_translations/translationdetailsmodalbody', context).done(function (html) {\n                    ModalFactory.create({\n                        title: langStrings[0],\n                        body: html,\n                        type: ModalFactory.types.ALERT\n                    }).then(function (modal) {\n                        modal.show();\n                    });\n                });\n            }).fail(Notification.exception);\n        },\n        'register': function (key, translationinfo) {\n            translation_button.objects[key] = translationinfo;\n        },\n        'findElementsDirectlyContainingText': function (ancestor, text) {\n            var elements = [];\n            walk(ancestor);\n            return elements;\n\n            function walk(element) {\n                var n = element.childNodes.length;\n                for (var i = 0; i < n; i++) {\n                    var child = element.childNodes[i];\n                    if (child.nodeType === 3 && child.data.indexOf(text) !== -1) {\n                        elements.push(element);\n                        break;\n                    }\n                }\n                for (var i = 0; i < n; i++) {\n                    var child = element.childNodes[i];\n                    if (child.nodeType === 1) {\n                        walk(child);\n                    }\n                }\n            }\n        },\n        objects: {}\n    };\n\n    return translation_button;\n});\n"],"file":"translation_button.min.js"}